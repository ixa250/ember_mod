import os
import subprocess

ZIP_DIR = "malware_samples"
EXTRACT_DIR = "extracted_exe"
PASSWORD = "infected"
SEVEN_ZIP_PATH = r"C:\Program Files\7-Zip\7z.exe"  # Đường dẫn tới 7z.exe

os.makedirs(EXTRACT_DIR, exist_ok=True)

count = 0
for file in os.listdir(ZIP_DIR):
    if not file.endswith(".zip"):
        continue

    zip_path = os.path.join(ZIP_DIR, file)
    try:
        # Gọi 7z bằng subprocess
        subprocess.run([
            SEVEN_ZIP_PATH,
            'x', zip_path,
            f"-o{EXTRACT_DIR}",
            f"-p{PASSWORD}",
            "-y"  # auto yes to all prompts
        ], check=True)
        print(f"[+] Đã giải nén: {file}")
        count += 1
    except Exception as e:
        print(f"[!] Lỗi giải nén !{file}: {e}")

print(f"\n Đã giải nén thành công ! {count} file .zip")
