import os
import subprocess

ZIP_DIR = "malware_samples"
EXTRACT_DIR = "extracted_exe"
PASSWORD = "infected"
WINRAR_PATH = r"C:\Program Files\WinRAR\WinRAR.exe"  # Đường dẫn tới WinRAR.exe

os.makedirs(EXTRACT_DIR, exist_ok=True)

count = 0
for file in os.listdir(ZIP_DIR):
    if not file.endswith(".zip"):
        continue

    zip_path = os.path.join(ZIP_DIR, file)
    try:
        # Gọi WinRAR để giải nén
        subprocess.run([
            WINRAR_PATH,
            "x",  # extract files with full path
            "-ibck",  # ẩn cửa sổ WinRAR (background)
            f"-p{PASSWORD}",
            zip_path,
            EXTRACT_DIR
        ], check=True)
        print(f"[+] Đã giải nén: {file}")
        count += 1
    except Exception as e:
        print(f"[!] Lỗi giải nén {file}: {e}")

print(f"\n✅ Đã giải nén thành công {count} file .zip")
